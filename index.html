<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>MyCosts Titanium v16</title>
    
    <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ë–ò–ë–õ–ò–û–¢–ï–ö -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- –°–¢–ò–õ–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø -->
    <style>
        :root {
            /* === –¶–í–ï–¢–û–í–ê–Ø –ü–ê–õ–ò–¢–†–ê (ONYX DARK) === */
            --bg-root: #000000;
            --bg-surface: #151517;
            --bg-modal: #1c1c1e;
            --bg-input: #2c2c2e;
            --bg-active: #3a3a3c;
            
            /* –¢–ï–ö–°–¢ */
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --text-tertiary: #636366;
            
            /* –ë–†–ï–ù–î–ò–ù–ì */
            --brand-primary: #0a84ff; /* iOS Blue */
            --brand-dim: rgba(10, 132, 255, 0.15);
            
            /* –°–ï–ú–ê–ù–¢–ò–ö–ê */
            --color-success: #30d158; /* Green */
            --color-danger: #ff453a;  /* Red */
            --color-warning: #ffd60a; /* Yellow */
            
            /* –†–ê–ó–ú–ï–†–´ */
            --radius-l: 24px;
            --radius-m: 16px;
            
            /* –®–†–ò–§–¢ */
            --font-family: 'Manrope', -apple-system, sans-serif;
            
            /* –ë–ï–ó–û–ü–ê–°–ù–´–ï –ó–û–ù–´ */
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* === –ë–ê–ó–û–í–´–ô –°–ë–†–û–° === */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            background-color: var(--bg-root);
            color: var(--text-primary);
            font-family: var(--font-family);
            margin: 0; padding: 0;
            padding-bottom: calc(100px + var(--safe-area-bottom));
            overflow-x: hidden;
            font-size: 16px;
        }

        .container {
            padding: 16px;
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }

        /* === –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê === */
        h1 { font-size: 32px; font-weight: 800; letter-spacing: -0.5px; margin: 0 0 10px 0; }
        h2 { font-size: 22px; font-weight: 700; margin: 0; }
        h3 { font-size: 17px; font-weight: 600; color: var(--text-secondary); margin: 0; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .num-hero { font-size: 44px; font-weight: 800; letter-spacing: -1px; line-height: 1.1; }
        .text-label { font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 1px; display: block; margin-bottom: 6px; }
        .text-sm { font-size: 13px; color: var(--text-secondary); }

        /* === –ö–û–ú–ü–û–ù–ï–ù–¢–´ === */
        .card {
            background: var(--bg-surface);
            border-radius: var(--radius-l);
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .flex-row { display: flex; justify-content: space-between; align-items: center; }
        .flex-col { display: flex; flex-direction: column; gap: 4px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }

        /* –ö–ù–û–ü–ö–ò */
        .btn {
            width: 100%; padding: 16px; border-radius: var(--radius-m); border: none;
            font-size: 16px; font-weight: 700; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.97); opacity: 0.9; }
        
        .btn-primary { background: var(--brand-primary); color: white; box-shadow: 0 4px 15px var(--brand-dim); }
        .btn-secondary { background: var(--bg-input); color: var(--text-primary); }
        
        .icon-btn {
            width: 44px; height: 44px; border-radius: 50%;
            background: var(--bg-input); color: var(--text-primary);
            border: none; font-size: 22px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }

        /* –ü–û–õ–Ø –í–í–û–î–ê */
        .input-money {
            width: 100%; background: transparent; border: none;
            font-size: 48px; font-weight: 800; color: white;
            text-align: center; padding: 20px 0;
        }
        .input-std {
            width: 100%; padding: 16px; background: var(--bg-input);
            border: 1px solid transparent; border-radius: var(--radius-m);
            color: white; font-size: 16px; margin-bottom: 12px;
        }
        .input-std:focus { border-color: var(--brand-primary); background: var(--bg-active); }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –î–ê–¢–ï */
        .date-picker {
            display: flex; align-items: center; justify-content: center; gap: 16px;
            background: var(--bg-surface); padding: 8px; border-radius: 100px;
            border: 1px solid rgba(255,255,255,0.1); margin-bottom: 24px;
        }
        .date-arrow { font-size: 24px; color: var(--text-secondary); padding: 4px; cursor: pointer; }
        .date-value { font-weight: 700; font-size: 15px; min-width: 140px; text-align: center; }

        /* –ü–†–û–ì–†–ï–°–° –ë–ê–†–´ */
        .progress-track {
            width: 100%; height: 8px; background: var(--bg-input);
            border-radius: 4px; overflow: hidden; margin-top: 10px;
        }
        .progress-fill { height: 100%; transition: width 0.6s ease; border-radius: 4px; }
        .bg-green { background: var(--color-success); }
        .bg-red { background: var(--color-danger); }

        /* –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ */
        .tab-bar {
            position: fixed; bottom: 24px; left: 20px; right: 20px;
            background: rgba(30, 30, 32, 0.9); backdrop-filter: blur(20px);
            border-radius: 32px; padding: 14px 28px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid rgba(255,255,255,0.1); z-index: 100;
            max-width: 460px; margin: 0 auto; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .tab-item { font-size: 26px; color: var(--text-secondary); padding: 5px; transition: 0.2s; cursor: pointer; position: relative; }
        .tab-item.active { color: var(--text-primary); transform: translateY(-4px); }
        .tab-item.active::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; border-radius: 50%; background: var(--brand-primary);
        }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal-backdrop {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000;
            opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .modal-backdrop.active { opacity: 1; pointer-events: all; }
        
        .modal-sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--bg-modal); border-radius: 32px 32px 0 0;
            padding: 24px; padding-bottom: 50px;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 1001; max-height: 90vh; overflow-y: auto;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .modal-sheet.active { transform: translateY(0); }

        /* –£–¢–ò–õ–ò–¢–´ */
        .hidden { display: none !important; }
        .scroll-h { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 5px; }
        
        .chip { 
            background: var(--bg-input); padding: 12px 16px; border-radius: 16px; 
            min-width: 120px; flex-shrink: 0; border: 1px solid transparent; cursor: pointer;
        }
        .chip.active { border-color: var(--brand-primary); background: rgba(10,132,255,0.15); }

        .icon-select {
            aspect-ratio: 1; background: var(--bg-input); border-radius: 14px;
            display: flex; align-items: center; justify-content: center; font-size: 24px;
            border: 2px solid transparent; cursor: pointer;
        }
        .icon-select.selected { border-color: var(--brand-primary); background: rgba(10,132,255,0.15); }

        /* –ó–ê–ì–†–£–ó–ß–ò–ö */
        #ui-loader {
            position: fixed; inset: 0; background: #000;
            z-index: 9999; display: flex; align-items: center; justify-content: center;
            transition: opacity 0.5s;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid #333; border-top-color: var(--brand-primary);
            border-radius: 50%; animation: spin 1s infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* –°–¢–ê–¢–£–° */
        .status-pill {
            padding: 6px 12px; background: var(--bg-input); border-radius: 20px;
            display: flex; gap: 8px; align-items: center; font-size: 12px; font-weight: 700;
        }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .dot-green { background: var(--color-success); box-shadow: 0 0 10px var(--color-success); }
        .dot-yellow { background: var(--color-warning); animation: pulse 1s infinite; }
        .dot-red { background: var(--color-danger); }
        @keyframes pulse { 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <!-- 0. –ó–ê–ì–†–£–ó–ß–ò–ö -->
    <div id="ui-loader">
        <div class="spinner"></div>
    </div>

    <!-- 1. –û–ù–ë–û–†–î–ò–ù–ì (–≠–ö–†–ê–ù –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø) -->
    <div id="screen-onboarding" class="container hidden" style="text-align: center; padding-top: 100px;">
        <div style="font-size: 64px; margin-bottom: 20px;">üëã</div>
        <h1>–ü—Ä–∏–≤–µ—Ç!</h1>
        <p class="text-label" style="text-transform: none; font-size: 15px; margin-bottom: 40px; opacity: 0.7;">
            –¢–≤–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä.<br>–î–∞–≤–∞–π –Ω–∞—Å—Ç—Ä–æ–∏–º –ø—Ä–æ—Ñ–∏–ª—å.
        </p>
        
        <input type="text" id="setup-name" class="input-std" placeholder="–¢–≤–æ–µ –∏–º—è" style="text-align: center;">
        <input type="number" id="setup-limit" class="input-std" placeholder="–ë—é–¥–∂–µ—Ç –Ω–∞ –º–µ—Å—è—Ü (‚ÇΩ)" style="text-align: center;">
        
        <button class="btn btn-primary" onclick="App.finishOnboarding()" style="margin-top: 20px;">
            –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
        </button>
    </div>

    <!-- 2. –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <div id="screen-app" class="container hidden">
        
        <!-- –í–ï–†–•–ù–Ø–Ø –®–ê–ü–ö–ê -->
        <div class="flex-row" style="margin-bottom: 20px; padding-top: 10px;">
            <div class="status-pill" onclick="Sync.push(true)">
                <div class="status-dot" id="sync-dot"></div>
                <span id="sync-text">CONNECTING</span>
            </div>
            <div style="font-weight: 700; font-size: 16px;" id="user-display">User</div>
        </div>

        <!-- >>> –≠–ö–†–ê–ù 1: –ì–õ–ê–í–ù–ê–Ø (HOME) <<< -->
        <div id="view-home">
            
            <!-- –ú–ê–®–ò–ù–ê –í–†–ï–ú–ï–ù–ò -->
            <div class="date-picker">
                <i class="ri-arrow-left-s-line date-arrow" onclick="TimeMachine.prev()"></i>
                <div class="date-value" id="month-display">...</div>
                <i class="ri-arrow-right-s-line date-arrow" onclick="TimeMachine.next()"></i>
            </div>

            <!-- –ì–õ–ê–í–ù–´–ô –ë–ê–õ–ê–ù–° -->
            <div class="card" style="text-align: center; padding: 32px 20px;">
                <span class="text-label">–û–ë–©–ò–ô –ö–ê–ü–ò–¢–ê–õ</span>
                <div class="input-money" style="font-size: 42px; padding: 10px 0;" id="val-total">0 ‚ÇΩ</div>
                
                <div class="grid-2" style="margin-top: 24px;">
                    <button class="btn btn-secondary" style="color: var(--color-danger); background: rgba(255, 69, 58, 0.1);" onclick="Modal.openTx('expense')">
                        <i class="ri-arrow-down-line"></i> –†–∞—Å—Ö–æ–¥
                    </button>
                    <button class="btn btn-secondary" style="color: var(--color-success); background: rgba(48, 209, 88, 0.1);" onclick="Modal.openTx('income')">
                        <i class="ri-arrow-up-line"></i> –î–æ—Ö–æ–¥
                    </button>
                </div>
            </div>

            <!-- CASHFLOW (–§–ò–ù–ê–ù–°–û–í–ê–Ø –°–í–û–ë–û–î–ê) -->
            <div class="card">
                <div class="flex-row">
                    <span class="text-label" style="margin:0">–°–í–û–ë–û–î–ê</span>
                    <span style="font-weight: 800;" id="val-freedom">0%</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill bg-green" id="bar-freedom" style="width: 0%"></div>
                </div>
                <div class="flex-row" style="margin-top: 12px;">
                    <div>
                        <span class="text-label" style="font-size: 10px;">–ü–ê–°–°–ò–í–ù–´–ô</span>
                        <div style="font-weight: 700; color: var(--color-success);" id="val-passive">0 ‚ÇΩ</div>
                    </div>
                    <div style="text-align: right;">
                        <span class="text-label" style="font-size: 10px;">–†–ê–°–•–û–î–´ (–ú–ï–°)</span>
                        <div style="font-weight: 700; color: var(--color-danger);" id="val-expense">0 ‚ÇΩ</div>
                    </div>
                </div>
            </div>

            <!-- –ë–Æ–î–ñ–ï–¢ -->
            <div class="card">
                <div class="flex-row">
                    <span class="text-label" style="margin:0">–û–°–¢–ê–¢–û–ö –ë–Æ–î–ñ–ï–¢–ê</span>
                    <span style="font-weight: 700;" id="val-budget">0 ‚ÇΩ</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill bg-red" id="bar-budget" style="width: 0%"></div>
                </div>
            </div>

            <!-- –°–ü–ò–°–û–ö –°–ß–ï–¢–û–í -->
            <div class="flex-row" style="margin-bottom: 12px;">
                <h3>–ú–æ–∏ –°—á–µ—Ç–∞</h3>
                <span class="text-label" style="color: var(--brand-primary); cursor: pointer;" onclick="Nav.to('wallet')">–í–°–ï</span>
            </div>
            <div class="horizontal-scroll" id="list-acc-home"></div>

            <!-- –ò–°–¢–û–†–ò–Ø –û–ü–ï–†–ê–¶–ò–ô -->
            <div class="flex-row" style="margin-top: 24px; margin-bottom: 12px;">
                <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
                <span class="text-label" style="color: var(--brand-primary); cursor: pointer;" onclick="Nav.to('stats')">–ê–ù–ê–õ–ò–ó</span>
            </div>
            <div id="list-tx-home" style="padding-bottom: 20px;"></div>
        </div>

        <!-- >>> –≠–ö–†–ê–ù 2: –ò–ù–í–ï–°–¢–ò–¶–ò–ò <<< -->
        <div id="view-invest" class="hidden">
            <h2>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</h2>
            <p class="text-label" style="text-transform: none; font-size: 14px; opacity: 0.7;">–†–æ—Å—Ç –∫–∞–ø–∏—Ç–∞–ª–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏</p>
            
            <div class="card">
                <div class="flex-row">
                    <span class="text-label">–ü–†–û–ì–ù–û–ó (1 –ì–û–î)</span>
                    <span style="color: var(--color-success); font-weight: 700;" id="val-forecast">+0 ‚ÇΩ</span>
                </div>
                <div style="height: 220px; margin-top: 15px;">
                    <canvas id="chart-invest"></canvas>
                </div>
            </div>
            
            <h3>–ü–æ—Ä—Ç—Ñ–µ–ª—å</h3>
            <div id="list-inv" style="margin-top: 12px;"></div>
        </div>

        <!-- >>> –≠–ö–†–ê–ù 3: –ê–ù–ê–õ–ò–¢–ò–ö–ê <<< -->
        <div id="view-stats" class="hidden">
            <h2>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            <br>
            <div class="grid-2" style="margin-bottom: 20px;">
                <button class="btn btn-secondary" onclick="Stats.setMode('expense')">–†–∞—Å—Ö–æ–¥—ã</button>
                <button class="btn btn-secondary" onclick="Stats.setMode('income')">–î–æ—Ö–æ–¥—ã</button>
            </div>
            
            <div class="card">
                <div style="height: 260px; position: relative;">
                    <canvas id="chart-pie"></canvas>
                </div>
            </div>
            
            <div id="list-stats"></div>
        </div>

        <!-- >>> –≠–ö–†–ê–ù 4: –£–ü–†–ê–í–õ–ï–ù–ò–ï (WALLET) <<< -->
        <div id="view-wallet" class="hidden">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
            <br>
            
            <div class="card">
                <div class="flex-row" style="margin-bottom: 16px;">
                    <h3>–°—á–µ—Ç–∞</h3>
                    <button class="btn-icon" onclick="Modal.openAcc()"><i class="ri-add-line"></i></button>
                </div>
                <div id="list-acc-manage"></div>
            </div>

            <div class="card">
                <div class="flex-row" style="margin-bottom: 16px;">
                    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <button class="btn-icon" onclick="Modal.openCat()"><i class="ri-add-line"></i></button>
                </div>
                <div id="list-cat-manage"></div>
            </div>
            
            <button class="btn btn-secondary" style="margin-top: 20px; color: var(--color-danger);" onclick="App.reset()">
                <i class="ri-delete-bin-line"></i> –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
            </button>
        </div>

    </div>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
    <div class="tab-bar">
        <i class="ri-home-5-fill tab-item active" onclick="Nav.to('home', this)"></i>
        <i class="ri-line-chart-fill tab-item" onclick="Nav.to('invest', this)"></i>
        <i class="ri-pie-chart-2-fill tab-item" onclick="Nav.to('stats', this)"></i>
        <i class="ri-wallet-3-fill tab-item" onclick="Nav.to('wallet', this)"></i>
    </div>
    <!-- ========================================== -->
    <!-- –í–°–ü–õ–´–í–ê–Æ–©–ò–ï –û–ö–ù–ê (SHEETS) -->
    <!-- ========================================== -->
    
    <div class="modal-backdrop" id="backdrop" onclick="Modal.closeAll()"></div>

    <!-- 1. –û–ö–ù–û –¢–†–ê–ù–ó–ê–ö–¶–ò–ò -->
    <div class="modal-sheet" id="sheet-tx">
        <div class="sheet-handle"></div>
        
        <div class="flex-row" style="margin-bottom: 20px;">
            <h2 id="tx-title">–†–∞—Å—Ö–æ–¥</h2>
            <div class="btn-icon" onclick="Modal.closeAll()"><i class="ri-close-line"></i></div>
        </div>
        
        <!-- –°—É–º–º–∞ -->
        <input type="text" id="tx-amt" class="input-money" placeholder="0" inputmode="decimal">
        
        <!-- –°—á–µ—Ç -->
        <span class="text-label">–°–ß–ï–¢</span>
        <div class="horizontal-scroll" id="tx-accs-list" style="margin-bottom: 24px;"></div>
        
        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <span class="text-label">–ö–ê–¢–ï–ì–û–†–ò–Ø</span>
        <div class="grid-4" id="tx-cats-list" style="margin-bottom: 24px;"></div>
        
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
        <input type="text" id="tx-note" class="input-std" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        
        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="grid-2">
            <button class="btn btn-primary" onclick="Actions.saveTx()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="btn btn-secondary hidden" id="tx-del-btn" style="color:var(--color-danger)" onclick="Actions.deleteTx()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>

    <!-- 2. –û–ö–ù–û –°–ß–ï–¢–ê -->
    <div class="modal-sheet" id="sheet-acc">
        <div class="sheet-handle"></div>
        <div class="flex-row"><h2>–°—á–µ—Ç</h2> <div class="btn-icon" onclick="Modal.closeAll()"><i class="ri-close-line"></i></div></div><br>
        
        <label class="text-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input type="text" id="acc-name" class="input-std" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞">
        
        <div class="grid-2" style="margin-bottom: 16px;">
            <button class="btn btn-secondary" id="type-card" onclick="Actions.setAccType('card')">–ö–∞—Ä—Ç–∞</button>
            <button class="btn btn-secondary" id="type-invest" onclick="Actions.setAccType('invest')">–ò–Ω–≤–µ—Å—Ç</button>
        </div>
        
        <div id="acc-invest-opts" class="hidden">
            <label class="text-label">% –ì–û–î–û–í–´–•</label>
            <input type="number" id="acc-percent" class="input-std" placeholder="15">
        </div>
        
        <label class="text-label">–ë–ê–õ–ê–ù–°</label>
        <input type="number" id="acc-bal" class="input-std" placeholder="0">
        
        <div class="grid-2" style="margin-top: 10px;">
            <button class="btn btn-primary" onclick="Actions.saveAcc()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="btn btn-secondary" style="color:var(--color-danger)" onclick="Actions.delAcc()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>

    <!-- 3. –û–ö–ù–û –ö–ê–¢–ï–ì–û–†–ò–ò -->
    <div class="modal-sheet" id="sheet-cat">
        <div class="sheet-handle"></div>
        <div class="flex-row"><h2>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h2> <div class="btn-icon" onclick="Modal.closeAll()"><i class="ri-close-line"></i></div></div><br>
        
        <label class="text-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input type="text" id="cat-name" class="input-std" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
        
        <div class="grid-2" style="margin-bottom: 16px;">
            <button class="btn btn-secondary" id="ctype-exp" onclick="Actions.setCatType('expense')">–†–∞—Å—Ö–æ–¥</button>
            <button class="btn btn-secondary" id="ctype-inc" onclick="Actions.setCatType('income')">–î–æ—Ö–æ–¥</button>
        </div>
        
        <span class="text-label">–ò–ö–û–ù–ö–ê</span>
        <div class="grid-4" id="cat-icons-grid" style="margin-bottom: 20px;"></div>
        
        <div class="grid-2">
            <button class="btn btn-primary" onclick="Actions.saveCat()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="btn btn-secondary" style="color:var(--color-danger)" onclick="Actions.delCat()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>
    <script>
        /**
         * ==========================================
         * MYCOSTS TITANIUM v16 - CORE ENGINE
         * ==========================================
         */

        // 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        // ------------------------------------------
        // !!! –í–°–¢–ê–í–¨ –°–°–´–õ–ö–£ –ú–ï–ñ–î–£ –ö–ê–í–´–ß–ï–ö !!!
        const API_URL = 'https://script.google.com/macros/s/AKfycby_ES9U2-4VYmPhMLbDtNNv_ESnbUEI9nlw0euEHsxZ6eJqu340_LpF_A1pSxyUvRxG/exec';

        // 2. –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï
        // ------------------------------------------
        const State = {
            db: { 
                user: { name: '', limit: 100000 }, 
                accounts: [], 
                categories: [], 
                transactions: [] 
            },
            userId: null,
            viewDate: new Date(), // –ú–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏
            temp: { // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                editId: null, 
                type: 'expense', 
                accId: null, 
                catId: null, 
                icon: null,
                statMode: 'expense' 
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // ID –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let uid = localStorage.getItem('onyx_uid');
        if (!uid) {
            uid = tg.initDataUnsafe?.user?.id 
                ? 'tg_' + tg.initDataUnsafe.user.id 
                : 'web_' + Date.now().toString().slice(-8);
            localStorage.setItem('onyx_uid', uid);
        }
        State.userId = uid;

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ DOM
        function safeGet(id) {
            const el = document.getElementById(id);
            if (!el) console.error(`Element not found: ${id}`);
            return el;
        }

        // ==========================================
        // 3. –Ø–î–†–û (CORE)
        // ==========================================
        const App = {
            init: () => {
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
                window.onload = () => {
                    // 1. –ì—Ä—É–∑–∏–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const local = localStorage.getItem('onyx_db');
                    let hasData = false;
                    
                    if (local) {
                        try {
                            State.db = JSON.parse(local);
                            hasData = State.db.accounts && State.db.accounts.length > 0;
                            // –ê–≤—Ç–æ-—Ñ–∏–∫—Å –∏–∫–æ–Ω–æ–∫
                            if(State.db.categories) {
                                State.db.categories.forEach(c => {
                                    if(c.icon && c.icon.length > 5) c.icon = 'üîπ';
                                });
                            }
                        } catch(e) { console.error('DB Parse Error', e); }
                    }

                    // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    setTimeout(() => {
                        const splash = safeGet('ui-loader');
                        if(splash) splash.style.opacity = '0';
                        
                        setTimeout(() => {
                            if(splash) splash.style.display = 'none';
                            
                            if (hasData) {
                                safeGet('screen-app').classList.remove('hidden');
                                Render.all();
                                Sync.pull(); // –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
                            } else {
                                safeGet('screen-onboarding').classList.remove('hidden');
                            }
                        }, 500);
                    }, 800);
                };
            },

            finishOnboarding: () => {
                const nameEl = safeGet('setup-name');
                const limitEl = safeGet('setup-limit');
                
                State.db.user.name = nameEl.value || 'User';
                State.db.user.limit = parseFloat(limitEl.value) || 100000;
                
                // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä
                State.db.accounts = [{id:'a1', name:'–ö–∞—Ä—Ç–∞', type:'card', balance:0, percent:0}];
                State.db.categories = [
                    {id:'c1', name:'–ï–¥–∞', icon:'üçî', type:'expense'},
                    {id:'c2', name:'–î–æ–º', icon:'üè†', type:'expense'},
                    {id:'c3', name:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', icon:'üöï', type:'expense'},
                    {id:'c4', name:'–ó–∞—Ä–ø–ª–∞—Ç–∞', icon:'üí∞', type:'income'}
                ];
                
                App.save();
                
                safeGet('screen-onboarding').classList.add('hidden');
                safeGet('screen-app').classList.remove('hidden');
                Render.all();
                Sync.push(true);
            },

            save: () => {
                localStorage.setItem('onyx_db', JSON.stringify(State.db));
                Render.all();
            },

            reset: () => {
                if(confirm('–°—Ç–µ—Ä–µ—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) {
                    localStorage.removeItem('onyx_db');
                    location.reload();
                }
            }
        };

        // ==========================================
        // 4. –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø (SYNC)
        // ==========================================
        const Sync = {
            status: (col, txt) => {
                const dot = safeGet('sync-dot');
                if(dot) dot.style.background = col==='green'?'#30d158':(col==='red'?'#ff453a':'#ffd60a');
                const txtEl = safeGet('sync-text');
                if(txtEl) txtEl.innerText = txt;
            },

            pull: async () => {
                Sync.status('yellow', 'LOAD');
                try {
                    const res = await fetch(`${API_URL}?action=load&user_id=${State.userId}&t=${Date.now()}`);
                    const json = await res.json();
                    
                    if(json.status === 'success' && json.data.accounts && json.data.accounts.length > 0) {
                        State.db.accounts = json.data.accounts;
                        State.db.categories = json.data.categories;
                        State.db.transactions = json.data.transactions;
                        if(json.data.user) State.db.user = json.data.user;
                        
                        Logic.calcInterest();
                        App.save();
                        Sync.status('green', 'ONLINE');
                    } else {
                        Sync.status('green', 'LOCAL');
                    }
                } catch(e) { Sync.status('red', 'OFFLINE'); }
            },

            push: async (force = false) => {
                if(!force) Sync.status('yellow', '...');
                try {
                    await fetch(API_URL+'?action=sync_all', {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({
                            user_id: State.userId,
                            accounts: State.db.accounts,
                            categories: State.db.categories,
                            transactions: State.db.transactions,
                            user: State.db.user
                        })
                    });
                    if(!force) Sync.status('green', 'OK');
                } catch(e) { Sync.status('red', 'ERR'); }
            },
            
            force: async () => { if(confirm('–û–±–Ω–æ–≤–∏—Ç—å –æ–±–ª–∞–∫–æ?')) await Sync.push(true); }
        };

        // ==========================================
        // 5. –õ–û–ì–ò–ö–ê (LOGIC)
        // ==========================================
        const TimeMachine = {
            change: (step) => { State.viewDate.setMonth(State.viewDate.getMonth() + step); Render.all(); },
            next: () => TimeMachine.change(1),
            prev: () => TimeMachine.change(-1),
            getKey: () => {
                const y = State.viewDate.getFullYear();
                const m = String(State.viewDate.getMonth() + 1).padStart(2, '0');
                return `${y}-${m}`;
            },
            getString: () => {
                const m = ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'];
                return `${m[State.viewDate.getMonth()]} ${State.viewDate.getFullYear()}`;
            }
        };

        const Logic = {
            calcInterest: () => {
                let changed = false;
                const now = Date.now();
                State.db.accounts.forEach(acc => {
                    if(acc.type === 'invest' && acc.percent > 0) {
                        const last = acc.lastCalc || now;
                        const days = (now - last) / (1000 * 60 * 60 * 24);
                        if(days >= 1) {
                            const profit = parseFloat(acc.balance) * (parseFloat(acc.percent)/100/365) * days;
                            if(profit > 0.1) {
                                State.db.transactions.push({
                                    id: 'sys_'+Date.now(),
                                    date: new Date().toISOString(),
                                    amount: profit, type: 'income', accountId: acc.id, categoryId: 'sys',
                                    comment: '%', isWaste: false
                                });
                                acc.lastCalc = now; changed = true;
                            }
                        }
                    }
                });
                if(changed) App.save();
            }
        };

        // ==========================================
        // 6. –†–ï–ù–î–ï–†–ò–ù–ì (RENDER)
        // ==========================================
        const Render = {
            all: () => {
                const elName = safeGet('user-display');
                if(elName) elName.innerText = State.db.user.name;
                
                const elMonth = safeGet('month-display');
                if(elMonth) elMonth.innerText = TimeMachine.getString();
                
                const monthKey = TimeMachine.getKey();

                // 1. –ë–∞–ª–∞–Ω—Å—ã
                const bals = {};
                State.db.accounts.forEach(a => bals[a.id] = parseFloat(a.balance || 0));
                
                let expM = 0, passM = 0;

                State.db.transactions.forEach(t => {
                    if(bals[t.accountId] !== undefined) {
                        t.type === 'income' ? bals[t.accountId] += parseFloat(t.amount) : bals[t.accountId] -= parseFloat(t.amount);
                    }
                    if(t.date.startsWith(monthKey) && t.type === 'expense') expM += parseFloat(t.amount);
                });

                State.db.accounts.filter(a => a.type === 'invest').forEach(a => {
                    passM += (bals[a.id] * (parseFloat(a.percent)/100)) / 12;
                });

                // 2. –î–∞—à–±–æ—Ä–¥
                const totalCap = Object.values(bals).reduce((a,b)=>a+b, 0);
                const elTotal = safeGet('total-balance');
                if(elTotal) elTotal.innerText = Math.floor(totalCap).toLocaleString() + ' ‚ÇΩ';

                const ff = expM > 0 ? (passM / expM * 100) : 0;
                safeGet('cf-pct').innerText = ff.toFixed(1) + '%';
                safeGet('cf-bar').style.width = Math.min(100, ff) + '%';
                safeGet('val-passive').innerText = '+' + Math.floor(passM).toLocaleString();
                safeGet('val-expense').innerText = '-' + Math.floor(expM).toLocaleString();

                const limit = State.db.user.limit || 100000;
                safeGet('bar-budget').style.width = Math.min(100, (expM / limit * 100)) + '%';
                safeGet('val-budget').innerText = (limit - expM).toLocaleString() + ' ‚ÇΩ';

                // 3. –°–ø–∏—Å–∫–∏
                const accHTML = State.db.accounts.map(a => 
                    `<div class="chip ${State.temp.accId == a.id ? 'active' : ''}" onclick="Actions.setTxAcc('${a.id}', this)">
                        <div class="text-label" style="text-transform:none; margin-bottom:4px;">${a.name}</div>
                        <div style="font-weight:700; font-size:16px;">${Math.floor(bals[a.id]).toLocaleString()}</div>
                    </div>`
                ).join('');
                safeGet('list-acc-home').innerHTML = accHTML;
                safeGet('tx-accs-list').innerHTML = accHTML;

                const monthTx = State.db.transactions.filter(t => t.date.startsWith(monthKey)).sort((a,b) => new Date(b.date) - new Date(a.date));
                safeGet('list-tx-home').innerHTML = monthTx.map(t => {
                    const c = State.db.categories.find(x => x.id == t.categoryId) || {name:'?', icon:'üîπ'};
                    return `<div class="card flex-between" onclick="Modal.editTx('${t.id}')" style="padding:16px; margin-bottom:10px; cursor:pointer;">
                        <div class="flex-center" style="gap:12px;">
                            <span style="font-size:24px">${c.icon}</span>
                            <div>
                                <div style="font-weight:600">${c.name}</div>
                                <div class="text-label" style="margin:0; opacity:0.6; text-transform:none;">${t.comment || new Date(t.date).toLocaleDateString()}</div>
                            </div>
                        </div>
                        <div style="font-weight:700; font-size:16px; color:${t.type == 'expense' ? 'var(--color-danger)' : 'var(--color-success)'}">
                            ${t.type == 'expense' ? '-' : '+'}${Math.floor(t.amount)}
                        </div>
                    </div>`;
                }).join('');

                safeGet('list-acc-manage').innerHTML = State.db.accounts.map(a => `<div class="flex-between" style="padding:12px 0; border-bottom:1px solid #333; cursor:pointer;" onclick="Modal.openAcc('${a.id}')"><b>${a.name}</b> <span>${Math.floor(bals[a.id])}</span></div>`).join('');
                safeGet('list-cat-manage').innerHTML = State.db.categories.map(c => `<div class="flex-between" style="padding:12px 0; border-bottom:1px solid #333; cursor:pointer;" onclick="Modal.openCat('${c.id}')"><div>${c.icon} ${c.name}</div></div>`).join('');
                safeGet('list-inv').innerHTML = State.db.accounts.filter(a=>a.type=='invest').map(a => `<div class="card flex-between"><div><b>${a.name}</b><br><span style="color:var(--color-success); font-size:12px;">${a.percent}% –≥–æ–¥.</span></div><b>${Math.floor(bals[a.id]).toLocaleString()}</b></div>`).join('');

                Render.charts(monthTx, bals);
            },

            charts: (txs, bals) => {
                const elPie = document.getElementById('chart-pie');
                if(elPie) {
                    const dataTx = txs.filter(t => t.type === (State.temp.statMode || 'expense'));
                    const cats = {}; 
                    dataTx.forEach(t => cats[t.categoryId] = (cats[t.categoryId]||0) + parseFloat(t.amount));
                    
                    if(window.pieChart) window.pieChart.destroy();
                    window.pieChart = new Chart(elPie, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(cats).map(id => State.db.categories.find(c => c.id == id)?.name),
                            datasets: [{
                                data: Object.values(cats),
                                backgroundColor: ['#0a84ff', '#30d158', '#ffd60a', '#ff453a', '#bf5af2'], borderWidth: 0
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#fff', font: { size: 11, family: 'Manrope' } } } } }
                    });
                    
                    safeGet('list-stats').innerHTML = Object.entries(cats).sort((a,b)=>b[1]-a[1]).map(([id,v])=>{
                        const c = State.db.categories.find(x=>x.id==id)||{name:'?',icon:''};
                        return `<div class="flex-between" style="padding:12px 0; border-bottom:1px solid #333"><div style="display:flex; gap:10px">${c.icon} ${c.name}</div><b>${Math.floor(v).toLocaleString()}</b></div>`
                    }).join('');
                }

                const elInv = document.getElementById('chart-inv');
                if(elInv) {
                    const invAccs = State.db.accounts.filter(a => a.type === 'invest');
                    const current = invAccs.reduce((s,a)=>s+bals[a.id], 0); const growth = current * 1.15;
                    safeGet('val-forecast').innerText = `+${Math.floor(growth-current).toLocaleString()} ‚ÇΩ`;
                    if(window.lineChart) window.lineChart.destroy();
                    window.lineChart = new Chart(elInv, {
                        type: 'line',
                        data: { labels: ['Q1','Q2','Q3','Q4'], datasets: [{ data: [current, current*1.04, current*1.08, growth], borderColor: '#30d158', backgroundColor: 'rgba(48,209,88,0.1)', fill: true, tension: 0.4 }] },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } }, elements: { point: { radius: 0 } } }
                    });
                }
            }
        };

        // ==========================================
        // 7. –î–ï–ô–°–¢–í–ò–Ø (ACTIONS)
        // ==========================================
        const Actions = {
            setTxAcc: (id, el) => { State.temp.accId = id; document.querySelectorAll('#tx-accs-list .chip').forEach(c=>c.classList.remove('active')); if(el) el.classList.add('active'); },
            
            saveTx: () => {
                const amt = parseFloat(safeGet('tx-amt').value);
                if(!amt || !State.temp.accId || !State.temp.catId) return;
                const tx = { id: State.temp.editId || 'tx_'+Date.now(), date: State.temp.editId ? State.db.transactions.find(t=>t.id==State.temp.editId).date : new Date().toISOString(), amount: amt, type: State.temp.type, accountId: State.temp.accId, categoryId: State.temp.catId, comment: safeGet('tx-note').value, isWaste: false };
                if(State.temp.editId) State.db.transactions[State.db.transactions.findIndex(t=>t.id==State.temp.editId)] = tx; else State.db.transactions.push(tx);
                App.save(); Modal.closeAll(); Sync.push(true);
            },
            deleteTx: () => { if(confirm('–£–¥–∞–ª–∏—Ç—å?')) { State.db.transactions = State.db.transactions.filter(t=>t.id!=State.temp.editId); App.save(); Modal.closeAll(); Sync.push(true); } },

            setAccType: (t) => { State.temp.type = t; safeGet('type-card').className = t=='card'?'btn btn-primary':'btn btn-secondary'; safeGet('type-invest').className = t=='invest'?'btn btn-primary':'btn btn-secondary'; safeGet('acc-invest-opts').classList.toggle('hidden', t!='invest'); },
            saveAcc: () => {
                const name = safeGet('acc-name').value; if(!name) return;
                const d = { id: State.temp.editId || 'acc_'+Date.now(), name, type: State.temp.type, balance: parseFloat(safeGet('acc-bal').value)||0, percent: parseFloat(safeGet('acc-percent').value)||0 };
                if(State.temp.editId) State.db.accounts[State.db.accounts.findIndex(x=>x.id==State.temp.editId)] = d; else State.db.accounts.push(d);
                App.save(); Modal.closeAll(); Sync.push(true);
            },
            delAcc: () => { if(State.temp.editId && confirm('–£–¥–∞–ª–∏—Ç—å?')) { State.db.accounts = State.db.accounts.filter(x=>x.id!=State.temp.editId); App.save(); Modal.closeAll(); Sync.push(true); } },

            setCatType: (t) => { State.temp.type = t; safeGet('ctype-exp').className = t=='expense'?'btn btn-primary':'btn btn-secondary'; safeGet('ctype-inc').className = t=='income'?'btn btn-primary':'btn btn-secondary'; },
            saveCat: () => {
                const name = safeGet('cat-name').value; if(!name) return;
                const d = { id: State.temp.editId || 'cat_'+Date.now(), name, type: State.temp.type, icon: State.temp.icon || 'üîπ' };
                if(State.temp.editId) State.db.categories[State.db.categories.findIndex(x=>x.id==State.temp.editId)] = d; else State.db.categories.push(d);
                App.save(); Modal.closeAll(); Sync.push(true);
            },
            delCat: () => { if(State.temp.editId && confirm('–£–¥–∞–ª–∏—Ç—å?')) { State.db.categories = State.db.categories.filter(x=>x.id!=State.temp.editId); App.save(); Modal.closeAll(); Sync.push(true); } }
        };

        const Modal = {
            openTx: (type) => {
                State.temp = { type, accId: State.db.accounts[0]?.id, catId: null, editId: null };
                safeGet('tx-title').innerText = type=='expense'?'–†–∞—Å—Ö–æ–¥':'–î–æ—Ö–æ–¥';
                safeGet('tx-amt').value = ''; safeGet('tx-note').value = ''; safeGet('tx-del-btn').classList.add('hidden');
                safeGet('tx-cats-list').innerHTML = State.db.categories.filter(c=>c.type==type).map(c => `<div class="icon-box" onclick="State.temp.catId='${c.id}'; Modal.hl(this)">${c.icon}</div>`).join('');
                Modal.open('sheet-tx'); Actions.setTxAcc(State.temp.accId);
            },
            editTx: (id) => {
                const t = State.db.transactions.find(x=>x.id==id); if(!t) return;
                Modal.openTx(t.type); State.temp.editId = id; State.temp.accId = t.accountId; State.temp.catId = t.categoryId;
                safeGet('tx-amt').value = t.amount; safeGet('tx-note').value = t.comment; safeGet('tx-del-btn').classList.remove('hidden');
            },
            openAcc: (id=null) => {
                State.temp.editId = id; safeGet('acc-name').value=''; safeGet('acc-bal').value=''; Actions.setAccType('card');
                if(id) { const a = State.db.accounts.find(x=>x.id==id); safeGet('acc-name').value=a.name; safeGet('acc-bal').value=a.balance; Actions.setAccType(a.type); if(a.type=='invest') safeGet('acc-percent').value=a.percent; }
                Modal.open('sheet-acc');
            },
            openCat: (id=null) => {
                State.temp.editId = id; State.temp.icon = 'üçî'; safeGet('cat-name').value=''; Actions.setCatType('expense');
                const icons = ['üçî','üöï','üè†','üíä','üõçÔ∏è','‚úàÔ∏è','üéÅ','‚öΩ','üí∞','üíº','üìà','üéì','üõí','üíÖ','üê∂'];
                safeGet('cat-icons-grid').innerHTML = icons.map(i => `<div class="icon-box" onclick="State.temp.icon='${i}'; Modal.hl(this)">${i}</div>`).join('');
                if(id) { const c = State.db.categories.find(x=>x.id==id); safeGet('cat-name').value=c.name; Actions.setCatType(c.type); }
                Modal.open('sheet-cat');
            },
            hl: (el) => { el.parentElement.querySelectorAll('.icon-box').forEach(e=>e.classList.remove('selected')); el.classList.add('selected'); },
            open: (id) => { safeGet('overlay').classList.add('open'); safeGet(id).classList.add('open'); },
            closeAll: () => { document.querySelectorAll('.sheet, .overlay').forEach(e=>e.classList.remove('open')); }
        };

        const Nav = { to: (scr, btn) => {
            document.querySelectorAll('[id^="view-"]').forEach(v=>v.classList.add('hidden'));
            safeGet('view-'+scr).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
            if(btn) btn.classList.add('active');
            if(scr=='stats' || scr=='invest' || scr=='home') Render.all();
        }};
        
        const Stats = { setMode: (m) => { State.temp.statMode = m; Render.all(); } };

        // START
        App.init();

    </script>
</body>
</html>
